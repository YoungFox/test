<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>

<body>
  <textarea name="" id="in" cols="30" rows="10"></textarea>
  <span class="parse">转换</span>
  <textarea name="" id="out" cols="30" rows="10"></textarea>
</body>
<script>
  var obj = {
    "code": 0,
    "msg": "success",
    "timestamp": 1606200906,
    "trace_id": "16062009061055278",
    "data": {
      "current_page": 1,
      "data": [
        {
          "id": 192678,
          "order_no": "O20050830670372",
          "user_id": "1153067",
          "username": "",
          "coin": "1",
          "pool": "1",
          "merchant": "bitdeer",
          "ap_group": "fsq1904",
          "partition": "cn",
          "ap_key": "FengShuiQi_BitMainAliyun20190415",
          "algorithm": "1",
          "hash_rate": "10.00",
          "hash_rate_unit": "5",
          "gift_hash_rate": "0.00",
          "revenue_rate": "0.00",
          "amount": "48.15",
          "coupon_discount": "0.00",
          "amount_before_discount": "48.15",
          "days": "140",
          "gift_days": "0",
          "coupon_add_days": "0",
          "pay_type": "all",
          "sale_type": "2",
          "status": "200",
          "start_time": 1591317400,
          "expire_time": 1603413400,
          "mined_time": "12096000",
          "delivery_time": 1591315200,
          "client_ip": "124.156.186.121",
          "receive_address": "1BJ4UUQLdG6stw7esVUATMo8RyT7WLhVDt",
          "locked_hash_rate": "0",
          "is_test": "0",
          "canceled_at": 0,
          "deleted_at": 0,
          "created_at": 1588918739,
          "updated_at": 1603413461,
          "sale_mining_machine": "T17",
          "work_mining_machine": "T17E",
          "sku_schema": "0",
          "share_percent": "0.00",
          "device_type": "0",
          "did": "",
          "pool_formatted": "AntPool",
          "revenue": "0.01086057",
          "coin_list": [
            "1"
          ],
          "coin_list_formatted": {
            "coin_1": "BTC"
          },
          "revenue_list": [],
          "roi": "20%",
          "sku_id": "200420244",
          "observer_url": "https:\/\/v3.antpool.com\/observer?accessKey=ZZ4l0Q9g3UYOFMM1ngvX &coinType =BTC",
          "observer_url_list": {
            "pool_1": {
              "pool_formatted": "AntPool",
              "url": "https:\/\/v3.antpool.com\/observer?accessKey=ZZ4l0Q9g3UYOFMM1ngvX &coinType =BTC"
            }
          },
          "current_receive_address": "1BJ4UUQLdG6stw7esVUATMo8RyT7WLhVDt",
          "current_receive_address_remark": "Matrix",
          "pass_day": 140,
          "mtn_info": {
            "total_mtn_days": "140",
            "total_worked_days": 140,
            "can_extend_days": -33,
            "can_extend_time": 0,
            "working_status": 0,
            "left_mtn_time": 0,
            "mtn_end_time": 1603413400,
            "left_contract_time": 0,
            "next_auto_deduction_time": -1,
            "mtn_pending_order": ""
          },
          "auto_deduction_info": {
            "order_auto_deduction": true
          },
          "show_computing_power_status": "Cp_completed",
          "order_item": {
            "id": 192678,
            "order_id": "192678",
            "sub_order_id": "744122",
            "sku_id": "200420244",
            "sku_cnt": "10",
            "user_mobile": "86-18211006026",
            "user_email": "yang6233562@126.com",
            "total_price": "48.15",
            "origin_price": "48.15",
            "hash_rate_price": "44.00",
            "electric_price": "4.15",
            "maintance_price": "0.00",
            "status": "1",
            "created_at": 1588918739,
            "updated_at": 1592909374,
            "hash_rate_add_price": "44.00",
            "electric_add_price": "4.15",
            "product_sku": {
              "id_primary": 1244,
              "id": "200420244",
              "merchant": "bitdeer",
              "name": "0420-\u4e30\u6c34T17-\u7ecf\u5178-10T",
              "description": "0417-\u4e30\u6c34T17-\u7ecf\u5178-10T",
              "hash_rate_price": "4.4000",
              "hash_rate_price_discount": "-1.",
              "electric_price": "0.0415",
              "electric_price_discount": "0.",
              "maintance_price": "0.0000",
              "maintance_price_discount": "0.",
              "hash_rate_discount_rate": "[[1,1,1]]",
              "electric_discount_rate": "[  [10,19,1,10], [20,39,1,20], [40,59,1,40], [60,1000,1,60]  ]",
              "maintance_discount_rate": "[[1,1,1]]",
              "algorithm": "1",
              "coin": "1",
              "pool": "1",
              "partition": "cn",
              "ap_group": "fsq1904",
              "default_currency": "1",
              "days": "140",
              "free_days": "0",
              "gift_days": [
                [
                  0,
                  100000,
                  0
                ]
              ],
              "hash_rate": "1",
              "hash_rate_unit": "5",
              "cnt": "10",
              "min_cnt": "0",
              "max_cnt": "0",
              "sum_max_cnt": "0",
              "status_is_online": "0",
              "status_is_delete": "0",
              "category": "53",
              "amount": "4440",
              "ext": {
                "recommend": "0",
                "electric_difference": null,
                "min_buy_days": "10",
                "mtn_step": "1",
                "pending_orders_limit": "0",
                "id_from": "200420243",
                "white_users": [],
                "white_group": ""
              },
              "weight": "17099",
              "is_spread": "0",
              "purchase_limit": "0",
              "start_time": 0,
              "end_time": 0,
              "mining_machine": null,
              "work_mining_machine": "T17",
              "sale_type": "2",
              "delivery_time": 1591315200,
              "env": "15",
              "remount_time": 0,
              "created_at": 1587401279,
              "updated_at": 1588918690,
              "customize": "0",
              "show_chinese": "\u8682\u8681\u77ff\u673a T17",
              "show_english": "Antminer T17",
              "sku_schema": "0",
              "share_percent": "0.00",
              "product_category": {
                "id": 53,
                "type": "undefined"
              },
              "hash_rate_final_price": "44.00",
              "hash_rate_final_original_price": "44.0000",
              "maintance_final_price": "58.10",
              "electric_final_price": 0,
              "final_price": "102.10",
              "price": "102.10",
              "total_hash_rate": "10",
              "coin_formatted": "Bitcoin",
              "coin_symbol": "BTC",
              "pool_formatted": "AntPool",
              "algorithm_formatted": "SHA256",
              "algorithm_unit_rate": "1",
              "hash_rate_unit_formatted": "TH\/s",
              "default_sku_id": "190408420",
              "default_hash_rate": "100",
              "default_index_sku_id": null,
              "default_index_hash_rate": null,
              "sold_percent": "11.20",
              "free_gift_days": 0,
              "mining_machine_key": "T17",
              "mining_machine_info": null
            }
          },
          "pool_modify_history": [],
          "address_modify_history": []
        }
      ],
      "first_page_url": "\/?page=1",
      "from": 1,
      "last_page": 4,
      "last_page_url": "\/?page=4",
      "next_page_url": "\/?page=2",
      "path": "\/",
      "per_page": 10,
      "prev_page_url": null,
      "to": 10,
      "total": 31
    }
  }
  function firstUpperCase(str) {
    return str.toLowerCase().replace(/( |^)[a-z]/g, (L) => L.toUpperCase());
  }

  function parse(obj, name = "XXX", resArr) {
    let outArr = []

    for (let i in obj) {
      let curItem = obj[i]
      let arr = []
      let tmpArr = i.split('_')
      tmpArr = tmpArr.map(item => firstUpperCase(item))
      let key = tmpArr.join('')
      arr.push(key)
      let type = typeof curItem
      if (Array.isArray(curItem)) {
        let item1 = curItem[0]
        if (item1) {
          type = typeof item1
          if (type === 'object' && !Array.isArray(item1)) {
            let tmp = `${key}Item`
            type = `[]${tmp}`
            parse(item1, tmp, resArr)
          } else {
            type = `[]${type}`
          }
        }
      } else if (type === 'object') {
        arr.push(key)

        arr.push('`json:"' + i + '"`')

        outArr.push(arr.join(' '))
        parse(curItem, key, resArr)
        continue
      }

      if (type === 'number') {
        type = 'int'
        if (curItem > 10000000) {
          type = 'int64'
        }
      }


      arr.push(type)
      arr.push('`json:"' + i + '"`')

      outArr.push(arr.join(' '))
    }
    let res = outArr.join('\n')
    let finalRes = `type ${name} struct {\n ${res} \n}`
    // console.log(finalRes)
    // return finalRes
    resArr.push(finalRes)
  }

  function proxyParse(obj, name = "XXX") {
    let finalArr = []
    parse(obj, name, finalArr)
    return finalArr.join('\n')
  }

  // let res = parse(obj)
  // console.log(res)

  let inval = document.querySelector('#in')
  let outval = document.querySelector('#out')
  let btn = document.querySelector('.parse')
  btn.addEventListener('click', function () {
    let val = inval.value
    try {
      val = JSON.parse(val)
    } catch (error) {

    }
    let res = proxyParse(val)
    outval.value = res
  })
</script>
<style>
  body {
    display: flex;
    align-items: center;
  }

  .parse {
    display: inline-block;
    color: #5c82ff;
    border: 1px solid #5c82ff;
    text-align: center;
    padding: 0 10px;
    height: 34px;
    border-radius: 4px;
    line-height: 34px;
    font-size: 14px;
    cursor: pointer;
    margin: 0 20px;
  }

  .parse:hover {
    background: #5c82ff;
    color: #fff;
  }

  textarea {
    width: 600px;
    height: 90vh;
  }
</style>

</html>