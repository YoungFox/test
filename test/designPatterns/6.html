<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>代理模式</title>
</head>

<body>
  <input type="checkbox" id="1">1</input>
  <input type="checkbox" id="2">2</input>
  <input type="checkbox" id="3">3</input>
  <input type="checkbox" id="4">4</input>
  <input type="checkbox" id="5">5</input>
  <input type="checkbox" id="6">6</input>
  <input type="checkbox" id="7">7</input>
  <input type="checkbox" id="8">8</input>
  <input type="checkbox" id="9">9</input>
  <input type="checkbox" id="10">10</input>
  <script>
    // var Flower = function(){}

    // var xiaoming = {
    //   sendFlower: function(target){
    //     var flower = new Flower()

    //     target.receiveFlower(flower)
    //   }
    // }

    // var B = {
    //   receiveFlower: function(flower){
    //     A.listenGoodMood(function(){
    //       A.receiveFlower(flower)
    //     })
    //   }
    // }

    // var A = {
    //   receiveFlower(flower){
    //     console.log('收到花： ' + flower)
    //   },
    //   listenGoodMood: function(fn){
    //     setTimeout(() => {
    //      fn() 
    //     }, 10000);
    //   }
    // }

    // xiaoming.sendFlower(B)


    // 虚拟代理

    // var myImage = (function(){
    //   var imgNode = document.createElement('img')
    //   document.body.appendChild(imgNode)
    //   imgNode.width = 400

    //   return {
    //     setSrc: function(src){
    //       imgNode.src = src
    //     }
    //   }
    // })()

    // var proxyImage = (function(){
    //   var img = new Image()
    //   img.onload = function(){
    //     myImage.setSrc(this.src)
    //   }
    //   return {
    //     setSrc: function(src){
    //       myImage.setSrc('./loading.png')
    //       img.src = src
    //     }
    //   }
    // })()

    // proxyImage.setSrc('http://timgsa.baidu.com/timg?image&quality=80&size=b10000_10000&sec=1577673500&di=2eadb85ec0ac9efe7f2b41490c3d8647&imgtype=jpg&src=http%3A%2F%2Fimg6.bdstatic.com%2Fimg%2Fimage%2Fpublic%2Ftanran2.jpg')



    // 虚拟代理合并HTTP请求

    // var synchronousFile = function(id){
    //   console.log('开始同步文件，id为： ' + id)
    // }

    // var checkbox = document.getElementsByTagName('input')

    // var proxySynchronousFile = (function(){
    //   var cache = []
    //   var timer

    //   return function(id){
    //     cache.push(id)

    //     if(timer){
    //       return
    //     }

    //     timer = setTimeout(() => {
    //       synchronousFile(cache.join(',')) 
    //       clearTimeout(timer)
    //       timer = null
    //       cache.length = 0
    //     }, 2000);
    //   }
    // })()


    // for(var i = 0,c;c=checkbox[i++];){
    //   c.onclick = function(){
    //     if(this.checked === true){
    //       proxySynchronousFile(this.id)
    //     }
    //   }
    // }



    // 虚拟代理对象

    // var miniConsole = (function () {
    //   var cache = []
    //   var handler = function (ev) {
    //     if (ev.keyCode === 113) {
    //       var script = document.createElement('script')
    //       script.onload = function () {
    //         for (var i = 0, fn; fn = cache[i++];) {
    //           fn()
    //         }
    //       }

    //       script.src = 'miniConsole.js'

    //       document.getElementsByTagName('head')[0].appendChild(script)
    //       document.body.removeEventListener('keydown', handler)
    //     }
    //   }

    //   document.body.addEventListener('keydown', handler, false)

    //   return {
    //     log: function () {
    //       var args = arguments
    //       cache.push(function () {
    //         return miniConsole.log.apply(miniConsole, args)
    //       })
    //     }
    //   }
    // })()

    // miniConsole.log(111)


    // 缓存代理

    // var mult = function () {
    //   console.log('开始计算')
    //   var a = 1
    //   for (var i = 0, l = arguments.length; i < l; i++) {
    //     a = a * arguments[i]
    //   }
    //   return a
    // }

    // console.log(mult(2, 3))
    // console.log(mult(2, 3, 4))

    // var proxyMult = (function () {
    //   var cache = {}

    //   return function () {
    //     var args = Array.prototype.join.call(arguments, ',')

    //     if (args in cache) {
    //       return cache[args]
    //     }
    //     return cache[args] = mult.apply(this, arguments)
    //   }
    // })()

    // console.log(proxyMult(1, 2, 3, 4))
    // console.log(proxyMult(1, 2, 3, 4))
    // console.log(proxyMult(1, 2, 3, 4))
    // console.log(proxyMult(1, 2, 3, 4))
    // console.log(proxyMult(1, 2, 3, 4))

    // 用高阶函数动态创建代理

    var mult = function () {
      console.log('开始乘积运算')
      var a = 1
      for (var i = 0, l = arguments.length; i < l; i++) {
        a = a + arguments[i]
      }
      return a
    }

    var plus = function () {
      console.log('开始加和运算')
      var a = 0
      for (var i = 0, l = arguments.length; i < l; i++) {
        a = a + arguments.length
      }
      return a
    }

    // 创建缓存代理的工厂
    var createProxyFactory = function (fn) {
      var cache = {}

      return function () {
        var args = Array.prototype.join.call(arguments, ',')
        if (args in cache) {
          return cache[args]
        }
        return cache[args] = fn.apply(this, arguments)
      }
    }

    var proxyMult = createProxyFactory(mult)
    var proxyPlus = createProxyFactory(plus)

    console.log(proxyMult(1, 2, 3, 4))
    console.log(proxyMult(1, 2, 3, 4))
    console.log(proxyPlus(1, 2, 3, 4))
    console.log(proxyPlus(1, 2, 3, 4))
  </script>
</body>

</html>